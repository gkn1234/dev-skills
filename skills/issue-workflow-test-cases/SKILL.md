---
name: issue-workflow-test-cases
description: 当用户从任务继续流程、或明确提到"测试用例"/"test cases"/"验收标准"时使用
---

# 创建测试用例

## Overview

根据任务内容自动生成验收测试用例建议，用户确认后创建 Issue 并双向关联到任务和上游 Issue（User Story 或 Problem）。使用自然语言描述业务场景，便于验收。

## 好的测试用例标准

| 原则 | 含义 | 检查点 |
|------|------|--------|
| **场景明确** | 测什么 | 描述具体的用户操作场景 |
| **预期清晰** | 期望什么 | 明确的预期结果 |
| **可验证** | 怎么验 | 能通过操作确认通过/失败 |
| **覆盖边界** | 异常情况 | 包含正常和异常场景 |

## 流程

### 1. 检测仓库
- 自动检测 `git remote`
- 失败则询问用户

### 2. 确定任务
- 对话上下文中有：直接使用
- 参数指定：`--task N`
- 否则：列出任务供选择

### 3. 读取任务详情

从任务 Issue 中提取：
- 任务描述
- 关联的上游 Issue 编号（User Story 或 Problem）
- 关联的上游 Issue（可选读取 Design 区块补充上下文）

### 4. 生成测试用例建议

根据任务内容自动生成建议：
- 正常场景（happy path）
- 边界情况
- 异常处理

呈现给用户确认/修改。

### 5. 质量检查

检查测试用例标准：
- 场景是否明确？
- 预期是否清晰？
- 是否覆盖边界情况？

有问题则提示用户补充。

### 6. 创建 Issue

确保 `test-cases` 标签存在，创建并关联 Milestone。

### 7. 双向更新

- 更新任务的 Test Cases 字段：`📄 #test_cases_number`
- 更新上游 Issue（User Story 或 Problem）的验收标准：添加 `- [ ] [Test Cases #N](#N)`

### 8. 引导下一步

"测试用例已创建 (#N) 并关联到任务 (#M) 和 User Story (#K) / Problem (#K)。现在可以开始实现任务了。"

## Issue 模板

根据用户对话语言自动选择：

**中文模板：**
```markdown
## 测试用例
- [ ] 【定稿：测试用例列表】

## 上游 Issue
📄 #parent_issue_number

## Task
📄 #task_number
```

**英文模板：**
```markdown
## Test Cases
- [ ] 【定稿：Test case list】

## Parent Issue
📄 #parent_issue_number

## Task
📄 #task_number
```

> **【定稿】**：流程第 4-5 步中确认的测试用例列表。

## Common Mistakes

| 错误 | 示例 | 正确做法 |
|------|------|----------|
| 太技术化 | "API 返回 200" | 用户视角："登录成功后跳转到首页" |
| 只有正常场景 | 只测成功情况 | 补充：密码错误、账号不存在等 |
| 预期模糊 | "应该正常工作" | 具体化："显示欢迎消息和用户名" |
| 不可验证 | "性能要好" | 量化："页面加载时间 < 2s" |
| 遗漏边界 | 忘记空值处理 | 补充：空输入、特殊字符等 |

## 示例

用户："帮我创建登录 API 的测试用例"

**自动生成建议：**
```
根据任务"实现登录 API 端点"，建议以下测试用例：

正常场景：
1. 用户使用有效邮箱和密码登录成功，返回 JWT token
2. 登录成功后可以使用 token 访问受保护资源

异常场景：
3. 使用错误密码登录失败，返回 401 错误
4. 使用不存在的邮箱登录失败，返回 401 错误
5. 密码为空时登录失败，返回 400 错误

边界情况：
6. 连续 5 次登录失败后触发限流，返回 429 错误

需要调整吗？
```

用户确认后 → 质量检查 → 创建 Issue → 更新任务和用户故事

## 上下游关系

| 方向 | 技能 | 说明 |
|------|------|------|
| 上游 | `issue-workflow-task` | 先有任务 |
| 关联 | `issue-workflow-user-story` | 更新用户故事的验收标准 |
| 关联 | `issue-workflow-problem` | 或更新问题的验收标准 |
