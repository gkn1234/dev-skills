---
name: issue-prd-review
description: 当用户提供 PRD 文档（飞书链接、文本或本地文件）、提到"评审 PRD"/"需求评估"/"review"/"技术评审"/"分析需求"/"创建 Issue"/"新需求"/"开始新项目"时使用。读取 PRD 进行技术评估，通过则创建主 Issue + 技术评估 Comment，不通过则输出问题清单打回给产品。
---

# Issue PRD Review - PRD 评估与 Issue 创建

## 职责

读取 PRD 文档，进行技术可行性评估。评估通过后创建主 Issue + 技术评估 Comment（含功能点拆分建议）。

## 前置：仓库检测

调用 `issue-repo` 技能确定目标仓库。

## 输入来源

| 输入类型 | 处理方式 | 示例 |
|----------|----------|------|
| 飞书文档链接 | WebFetch 读取 | `https://xxx.feishu.cn/docs/xxx` |
| 文本内容 | 直接使用对话中的 PRD 文本 | 用户粘贴的文本 |
| 本地文件 | Read 工具读取 | `docs/prd/feature-x.md` |

## 评估流程

### 阶段一：需求理解与初筛

对 PRD 进行理解和初步评估，发现问题则**立即打回**，无需进入阶段二：

**评估内容**：

- 总结需求的**核心目标**（一句话）
- 拆分**功能点**（每个成为一个子 Issue）
  - 每个子 Issue 可在 1-2 周内完成
  - 功能点之间尽量解耦
  - 有明确的验收标准
- 识别**边界条件**和**异常场景**
- 标记**需要澄清**的问题

**初筛检查点**：

| 检查项 | 不通过条件 |
|--------|-----------|
| 核心目标 | 无法用一句话概括 |
| 功能点 | 职责不清、边界模糊 |
| 边界条件 | 未说明或不完整 |
| 异常场景 | 缺失关键异常处理 |

→ **不通过**：使用 `review-rejected.md` 模板打回产品
→ **通过**：进入阶段二

---

### 阶段二：技术可行性分析

需求清晰后，进行技术层面的详细评估：

#### 2.1 代码影响分析

**优先使用 LSP 能力**（如 Go to Definition、Find References），更精准地分析依赖关系。

**备选方法**：

```bash
# 搜索相关模块
Grep: "相关关键词" --type ts

# 查看模块结构
Glob: "src/**/*.ts"

# 分析依赖关系
Read: package.json, 相关配置文件
```

**评估维度：**

| 维度         | 说明               |
| ------------ | ------------------ |
| 需修改的文件 | 现有文件的修改范围 |
| 需新增的文件 | 新模块、组件、配置 |
| 受影响的功能 | 爆炸半径评估       |
| 潜在风险点   | 可能引发的问题     |

#### 2.2 工作量评估

**规模定义：**

| 级别          | 预估改动文件数 | 复杂度              |
| ------------- | -------------- | ------------------- |
| `small`       | 1-5            | 简单修改            |
| `medium`      | 6-15           | 中等复杂度          |
| `large`       | 16-30          | 较高复杂度          |
| `extra-large` | 30+            | 高复杂度/架构级变更 |

**爆炸半径定义：**

| 级别        | 描述                     |
| ----------- | ------------------------ |
| `isolated`  | 仅影响单一模块           |
| `contained` | 影响相关的 2-3 个模块    |
| `moderate`  | 影响多个模块，需回归测试 |
| `wide`      | 影响核心流程，需全面测试 |

#### 2.3 测试建议

- **单元测试范围**：新增/修改的函数和类
- **集成测试范围**：模块间交互点
- **E2E 测试范围**：关键用户流程
- **重点关注场景**：边界条件和异常处理

#### 2.4 大致方案设计

提供 1-3 个可行的实现方案：

| 内容     | 描述               |
| -------- | ------------------ |
| 方案概述 | 简明描述技术方案   |
| 技术架构 | 架构图或组件说明   |
| 优缺点   | 客观分析 pros/cons |
| 推荐理由 | 为什么推荐此方案   |

→ **阶段二完成**：
- 创建主 Issue
- 添加技术评估 Comment
- 询问是否使用 `issue-design` 技能，为各个功能点创建子 Issue

## 操作命令

```bash
# 1. 创建主 Issue（无标签）
gh issue create \
  --repo {owner}/{repo} \
  --title "[PRD] {需求名称}" \
  --body-file /tmp/prd-issue.md

# 2. 获取主 Issue 号
MAIN_ISSUE=$(gh issue list --repo {owner}/{repo} --limit 1 --json number --jq '.[0].number')

# 3. 添加技术评估 Comment（含功能点拆分建议）
gh issue comment $MAIN_ISSUE \
  --repo {owner}/{repo} \
  --body-file /tmp/review-comment.md
```

**注意**：Body 内容较长时，先写入临时文件再使用 `--body-file`。

## 使用示例

**示例 1：评审通过**
```
用户: 帮我评审这个 PRD [粘贴内容]

助手: [调用 issue-repo 确定仓库]
      仓库: owner/repo

      [读取 PRD，代码影响分析]

      ## 技术评估结论：✅ 通过

      - 工作量：medium（约 10 个文件）
      - 爆炸半径：contained（影响 auth、user 模块）
      - 建议拆分为 3 个功能点：
        1. 用户登录表单
        2. JWT 认证服务
        3. OAuth 集成

      是否创建 Issue？

用户: 是

助手: [创建主 Issue #100]
      [添加技术评估 Comment]

      完成！主 Issue: #100
      → 下一步：使用 issue-design 为功能点创建子 Issue 并添加设计
```

**示例 2：评审不通过**
```
用户: 评审这个 PRD [粘贴内容]

助手: [读取 PRD，发现问题]

      ## 技术评估结论：❌ 不通过

      ### 待澄清问题
      1. **用户权限边界不清晰**
         - 当前描述：支持多角色访问
         - 问题：未定义具体角色和权限
         - 建议：列出所有角色及其权限矩阵

      2. **异常场景缺失**
         - 问题：未说明网络异常时的处理
         - 建议：补充离线状态和重试逻辑

      请产品完善后重新提交。
```

## 模板

| 模板 | 路径 | 用途 |
|------|------|------|
| 主 Issue | `shared/templates/prd-issue.md` | 主 Issue Body |
| 技术评估 | `shared/templates/review-comment.md` | 评估通过 Comment |
| 评审打回 | `shared/templates/review-rejected.md` | 评估不通过反馈 |

## 注意事项

- **主 Issue 无标签**：PRD 类型可能复杂，不强制分类
- **功能点拆分建议**：包含在技术评估 Comment 中，用户可调整
- **下游流程**：使用 `issue-design` 根据用户确认的功能点创建子 Issue，并添加设计 Comment
